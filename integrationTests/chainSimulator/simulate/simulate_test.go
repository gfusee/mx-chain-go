package simulate

import (
	"encoding/hex"
	"math/big"
	"testing"
	"time"

	"github.com/multiversx/mx-chain-core-go/core"
	"github.com/multiversx/mx-chain-core-go/data/transaction"
	"github.com/multiversx/mx-chain-go/config"
	"github.com/multiversx/mx-chain-go/node/chainSimulator"
	"github.com/multiversx/mx-chain-go/node/chainSimulator/components/api"
	"github.com/multiversx/mx-chain-go/node/chainSimulator/configs"
	"github.com/stretchr/testify/require"
)

const (
	defaultPathToInitialConfig = "../../../cmd/node/config/"
)

var (
	oneEGLD = big.NewInt(1000000000000000000)
)

func TestCostScDeploy(t *testing.T) {
	if testing.Short() {
		t.Skip("this is not a short test")
	}

	roundDurationInMillis := uint64(6000)
	roundsPerEpochOpt := core.OptionalUint64{
		HasValue: true,
		Value:    20,
	}

	cs, err := chainSimulator.NewChainSimulator(chainSimulator.ArgsChainSimulator{
		BypassTxSignatureCheck:   true,
		TempDir:                  t.TempDir(),
		PathToInitialConfig:      defaultPathToInitialConfig,
		NumOfShards:              3,
		GenesisTimestamp:         time.Now().Unix(),
		RoundDurationInMillis:    roundDurationInMillis,
		RoundsPerEpoch:           roundsPerEpochOpt,
		ApiInterface:             api.NewNoApiInterface(),
		MinNodesPerShard:         3,
		MetaChainMinNodes:        3,
		NumNodesWaitingListMeta:  3,
		NumNodesWaitingListShard: 3,
		AlterConfigsFunction: func(cfg *config.Configs) {

		},
	})
	require.NoError(t, err)
	require.NotNil(t, cs)

	err = cs.GenerateBlocksUntilEpochIsReached(1)
	require.NoError(t, err)

	initialBalance := big.NewInt(0).Mul(oneEGLD, big.NewInt(10))

	sender, err := cs.GenerateAndMintWalletAddress(0, initialBalance)
	require.NoError(t, err)

	err = cs.GenerateBlocksUntilEpochIsReached(1)
	require.NoError(t, err)

	receiver := "erd1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq6gq4hu"
	receiverBytes, _ := cs.GetNodeHandler(0).GetCoreComponents().AddressPubKeyConverter().Decode(receiver)

	dataField := "0061736d01000000018e011760027f7f0060000060017f017f60027f7f017f60017f0060037f7f7f017f60037f7f7f006000017f60047f7f7f7f0060047f7f7f7f017f60027f7e0060017e0060057f7f7e7f7f017f6000017e60027f7f017e60017f017e60077e7f7f7f7f7f7f017f60077f7e7f7f7f7f7f0060037e7e7f0060057f7f7f7f7f0060037f7f7f017e60027e7f0060037f7e7f0002f0072803656e760e626967496e74536574496e743634000a03656e7609626967496e74416464000603656e760b7369676e616c4572726f72000003656e760d6d427566666572417070656e64000303656e760a6d4275666665724e6577000703656e760d6d42756666657246696e697368000203656e76106d4275666665724765744c656e677468000203656e760f6d4275666665725365744279746573000503656e760d6d616e6167656443616c6c6572000403656e760f6d4275666665724765744279746573000303656e761167657453686172644f6641646472657373000203656e7612626967496e7447657443616c6c56616c7565000403656e76126d427566666572476574417267756d656e74000303656e76126d427566666572417070656e644279746573000503656e76126d616e616765645369676e616c4572726f72000403656e761b736d616c6c496e74476574556e7369676e6564417267756d656e74000f03656e7619626967496e74476574556e7369676e6564417267756d656e74000003656e760f6765744e756d417267756d656e7473000703656e7616736d616c6c496e7446696e697368556e7369676e6564000b03656e76186d616e616765644765744f726967696e616c547848617368000403656e76136d42756666657247657442797465536c696365000903656e76146d427566666572436f707942797465536c696365000903656e76196d42756666657246726f6d426967496e74556e7369676e6564000303656e76176d427566666572546f426967496e74556e7369676e6564000303656e76126d42756666657253746f726167654c6f6164000303656e76136d42756666657253746f7261676553746f7265000303656e760a626967496e745369676e000203656e760f6d616e6167656457726974654c6f67000003656e761b6d616e616765645472616e7366657256616c756545786563757465000c03656e760a6765744761734c656674000d03656e761f6d616e616765644465706c6f7946726f6d536f75726365436f6e7472616374001003656e76206d616e616765645570677261646546726f6d536f75726365436f6e7472616374001103656e76226d616e616765644d756c74695472616e73666572455344544e465445786563757465000c03656e760e636865636b4e6f5061796d656e74000103656e76106d616e61676564534341646472657373000403656e7614736d616c6c496e7446696e6973685369676e6564000b03656e76136765744e756d455344545472616e7366657273000703656e76136d616e616765644f776e657241646472657373000403656e76096d4275666665724571000303656e76106d616e616765644173796e6343616c6c000803e101df0102070801000200000000020000120000000002000603030603030002050005020207000003051303080607030400020200040702080505050502050002080004051405020504040401000404000700090002030509080600020902020400000a05030000020308030e0603000206030302020302000300030600030200000a0000000a00030e02020200150200001602000d070004070202000702020707000404000402070602060400060206020402010101010101010101010101010101010101010101010101010101010101010101010101010101010101010606040405030100030616037f01418080080b7f0041c9de080b7f0041d0de080b07d6062e066d656d6f7279020004696e697400d801077570677261646500d901076465706f73697400da010d64697363617264416374696f6e00db010c64697363617264426174636800dc010967657451756f72756d00dd01126765744e756d426f6172644d656d6265727300de010c6765744e756d47726f75707300df010f6765744e756d50726f706f7365727300e0010e676574416374696f6e47726f757000e101146765744c61737447726f7570416374696f6e496400e20112676574416374696f6e4c617374496e64657800e3011570726f706f7365416464426f6172644d656d62657200e4011270726f706f736541646450726f706f73657200e5011170726f706f736552656d6f76655573657200e6011370726f706f73654368616e676551756f72756d00e7011670726f706f73655472616e736665724578656375746500e8011a70726f706f73655472616e73666572457865637574654573647400e9011070726f706f73654173796e6343616c6c00ea011970726f706f736553434465706c6f7946726f6d536f7572636500eb011a70726f706f736553435570677261646546726f6d536f7572636500ec010c70726f706f7365426174636800ed01047369676e00ee01097369676e426174636800ef010e7369676e416e64506572666f726d00f001137369676e4261746368416e64506572666f726d00f10106756e7369676e00f2010b756e7369676e426174636800f301067369676e656400f4011d756e7369676e466f724f75746461746564426f6172644d656d6265727300f5010d71756f72756d5265616368656400f6010d706572666f726d416374696f6e00f7010c706572666f726d426174636800f8010b646e73526567697374657200f9011867657450656e64696e67416374696f6e46756c6c496e666f00fa010875736572526f6c6500fb0112676574416c6c426f6172644d656d6265727300fc010f676574416c6c50726f706f7365727300fd010d676574416374696f6e4461746100fe0110676574416374696f6e5369676e65727300ff0114676574416374696f6e5369676e6572436f756e7400800219676574416374696f6e56616c69645369676e6572436f756e740081020863616c6c4261636b0082020a5f5f646174615f656e6403010b5f5f686561705f6261736503020aefa101df011601017f1029220142001000200120012000100120010b1901017f418890084188900828020041016b220036020020000b1b00200120034b0440102b000b20002001360204200020023602000b0b0041f78f08410e1002000bff0301037f230041306b220324002001280200102d210220002802282002102e200028022c2002102e0240024002400240024002400240024002400240024020002f010041016b0e09010203040506070809000b20024100102f0c090b20024101102f2002200028020410300c080b20024102102f2002200028020410300c070b20024103102f2002200028020410300c060b20024104102f20002802042002102e0c050b20024105102f200041086a200210310c040b20024106102f200220002802181030200028021c220410322002102e2003200410063602142003410036021020032000411c6a36020c200341206a21040340200341186a2003410c6a10332003290318504504402004200210340c010b0b2000290308200029031020021035200028022020021036200041246a200210370c030b20024107102f200041086a200210310c020b20024108102f20002802042002103820022000280208103020002f0102200210392000410c6a200210370c010b20024109102f2002200028020410302000280208200210382002200028020c103020002f010220021039200041106a200210370b20002802302204103a2002102e2003200410063602202003410036021c2003200041306a36021803402003200341186a103b200328020004402002200328020410031a0c010b0b20012002360200200341306a24000b0f01017f10042201200010031a20010b4501017f230041106b220224002002200041187420004180fe03714108747220004108764180fe03712000411876727236020c20012002410c6a41041051200241106a24000b2601017f230041106b22022400200220013a000f20002002410f6a41011051200241106a24000b09002000200110031a0b37002001200028021010302000280214200110382000290300200041086a290300200110352000280218200110362000411c6a200110370b0900200010064104760b970202017e047f230041106b2203240020002001280204220441106a220620012802084d047e2001280200200341086a42003703002003420037030028020020042003411010771a2003290204210220032802002104200328020c2105200120063602042000200541187420054180fe03714108747220054108764180fe0371200541187672723602142000200441187420044180fe03714108747220044108764180fe0371200441187672723602102000200242388620024280fe0383422886842002428080fc0783421886200242808080f80f834208868484200242088842808080f80f832002421888428080fc07838420024228884280fe0383200242388884848437030842010542000b370300200341106a24000b1e002000280208200110362000290300200110b201200028020c200110380b1c00200050044020024100102f0f0b20024101102f2001200210b2010b4f01027f230041106b22022400200220001006220341187420034180fe03714108747220034108764180fe03712003411876727236020c20012002410c6a41041051200120001030200241106a24000b5b01027f230041206b2202240020002802002203103a2001102e20022003100636021c20024100360218200220003602140340200241086a200241146a103b20022802080440200228020c200110360c0105200241206a24000b0b0b0a0020001057200110360b3401017f230041106b220224002002200041087420004180fe0371410876723b010e20012002410e6a41021051200241106a24000b0900200010064102760b8a0101047f230041106b220324002001280204220241046a220420012802084b047f41000520012802002003410036020c28020020022003410c6a410410771a200328020c210220012004360204200241187420024180fe03714108747220024108764180fe037120024118767272210241010b21012000200236020420002001360200200341106a24000b7202047f027e230041106b2203240020012002103d210420012002103e2105200320012002103f20032903002107200329030821082001200210402106200020012002104136021c2000200636021820002005360214200020043602102000200837030820002007370300200341106a24000b0a00200041202001107b0b0a0020002001104010790b4301027e02400240024020012002108f0141ff01710e020201000b200241808008410d107e000b420121032001200210900121040b20002004370308200020033703000b0e00200020002001107a2001107b0b2e01027f20002001107a210210492103037f2002047f2003200020011040104a200241016b21020c010520030b0b0b7402047f027e230041106b22022400200110432103200141a482084108104421042002200110452002290300210620022903082107200141a4820841081046210520002001104736021c2000200536021820002004360214200020033602102000200737030820002006370300200241106a24000b0e002000412041a482084108107c0b0c00200020012002104610790b4d01027e024002400240200141a482084108106841ff01710e020201000b41a48208410841808008410d105c000b42012102200141a482084108106921030b20002003370308200020023703000b12002000200020012002106020012002107c0b3601027f200041a4820841081060210110492102037f2001047f2002200041a4820841081046104a200141016b21010c010520020b0b0b5901027f230041206b220124001049210220012000280200100636021c2001410036021820012000360214037f200141086a200141146a103b2001280208047f2002200128020c102d104a0c0105200141206a240020020b0b0b1301017f1029220041848f08410010071a20000b4601017f230041106b220224002002200141187420014180fe03714108747220014108764180fe03712001411876727236020c20002002410c6a4104100d1a200241106a24000b4101017f2001280204220220012802084b047f4100052001200241016a36020420012802002802002002104c210141010b210220002001360204200020023602000b0c0020002001108901108c010b4401017f230041106b22032400200341003b010e20002003410e6a410220012002104e20032f010e2100200341106a2400200041850c71410874200041800c71410876720b3000200041086a20002802002001200210810104402003200441b98108410f105c000b2000200028020020026a3602000b4201017f230041106b22022400200241003b010e20002002410e6a41022001105020022f010e2100200241106a2400200041850c71410874200041800c71410876720b2e00200041086a2000280200200120021081010440200341b98108410f107e000b2000200028020020026a3602000b0b00200020012002100d1a0b0a0041848f08410010530b1101017f102922022000200110071a20020b0700200010051a0b3101017f20011056220210062101200041003a00102000200136020c2000200236020820002001360204200041003602000b0d00200010292200100c1a20000b0f01017f10292201200010161a20010b0900200020011002000b3501017f230041106b220124002001200041087420004180fe0371410876723b010e41672001410e6a410210071a200141106a24000b0c01017f10292200100820000b1100200041a9de0810091a41a9de08100a0b2e01017f41b4800841171053220420002001100d1a200441cb80084103100d1a200420022003100d1a2004100e000b2c01017f104921030340200028020041a4de082802004e4504402003200020012002105e104a0c010b0b20030b0c00200020012002105f10560b2f01017f2000280200220341a4de082802004e04402001200241f380084111105c000b2000200341016a36020020030b5201017f230041106b220324002003410036020c20002003410c6a410420012002104e200328020c2100200341106a2400200041187420004180fe03714108747220004108764180fe0371200041187672720b0c00200041f88a08410910620b2c01017f10492103037f200028020041a4de082802004e047f2003052003200020012002105e104a0c010b0b0b4101017f2000027f200128020041a4de082802004e04401049210210490c010b200141a28a08410d105e2102200141a28a08410d10620b360204200020023602000b0c00200010292200101020000b3502017f017e20012002200310462104200120022003106921052000200120022003104436020c20002004360208200020053703000bd20102027f017e230041106b2203240020032001280208220241187420024180fe03714108747220024108764180fe0371200241187672723602002003200128020c220241187420024180fe03714108747220024108764180fe03712002411876727236020c20032001290300220442388620044280fe0383422886842004428080fc0783421886200442808080f80f834208868484200442088842808080f80f832004421888428080fc07838420044228884280fe03832004423888848484370204200020034110100d1a200341106a24000bbb0102017f027e230041206b220124002001410c6a41021055024002402001280210200128020c4604400c010b0240024002402001410c6a41af8a08410d106841ff01710e020201000b41af8a08410d41808008410d105c000b420121022001410c6a41af8a08410d106921030b2001280210200128020c470d010b20012d001c0440419cde08410036020041a0de0841003a00000b2000200337030820002002370300200141206a24000f0b41af8a08410d418d8008410e105c000b2f01017f230041106b22032400200341003a000f20002003410f6a410120012002104e20032d000f200341106a24000b860102017e017f230041106b22042400200442003703082000200441086a410820012002104e20042903082103200441106a2400200342388620034280fe0383422886842003428080fc0783421886200342808080f80f834208868484200342088842808080f80f832003421888428080fc07838420034228884280fe038320034238888484840b1f002000105622001006412047044020012002419482084110105c000b20000b6501027f230041206b220124002001410c6a220220001055200241818b08410d104d21002001280210200128020c46044020012d001c0440419cde08410036020041a0de0841003a00000b200141206a240020000f0b41818b08410d418d8008410e105c000b2401017e2000100f22034280808080105a044020012002418d8008410e105c000b2003a70b1900200041a4de082802004e04400f0b4184810841121002000b1400101120004604400f0b4196810841191002000b1900200041a4de082802004c04400f0b41f3800841111002000b0b0041a4de0810113602000b1f01017f2001103a21022000410036020820002002360204200020013602000b4f01017f230041206b2201240020012000280200100636021c20014100360218200120003602140340200141086a200141146a103b20012802080440200128020c10051a0c010b0b200141206a24000b0a002000108c01ad10120b0d002000450440200110051a0b0b1b01027f10292200101341af8108410a10532201200010031a20010b9c0101057f230041306b22022400200241286a22034200370300200241206a22044200370300200241186a2205420037030020024200370310200241086a200110062206200241106a4120102a200141002002280208200228020c10771a2000200636022020002002290310370000200041086a2005290300370000200041106a2004290300370000200041186a2003290300370000200241306a24000b0f00200020012003200210144100470b4401027f230041106b22022400200028020021032002200136020420022000290208370208200241046a22002802002802002003280200200028020420002802081027000b0d0020001029220010171a20000b5001017f230041106b220224002002410036020c20002002410c6a410420011050200228020c2100200241106a2400200041187420004180fe03714108747220004108764180fe0371200041187672720b4f01027f230041106b22032400200341086a2000280208200028020022042001107d20032802084101460440200328020c2000200120046a360200200341106a24000f0b200241b98108410f107e000b5101027f230041106b22042400200441086a2000280208200028020022052001107d20042802084101460440200428020c2000200120056a360200200441106a24000f0b2002200341b98108410f105c000b1f0020012002200310042201101521022000200136020420002002453602000b2c01017f41f58108411b10532203200010031a200341cb80084103100d1a200320012002100d1a2003100e000b3701017f230041106b22022400200241046a20011071200041086a2002410c6a28020036020020002002290204370200200241106a24000b070020001006450beb0101037f230041106b2204240002400240027f024020002d000845044020002802002205100622064190ce004b0d0141a0de082d00000d01419cde08200636020041a0de0841013a0000200441086a2006418c90084190ce00102a200541002004280208200428020c10771a20002d00080440419cde08410036020041a0de0841003a00000b200041013a00080b4101200120036a2200419cde082802004b0d011a20002001490d0220004190ce004b0d032001418c90086a210020022000200310830241000c010b200041003a0008200520012002200310770b200441106a24000f0b102b000b102b000b0d0020001029220010181a20000b0d002000416710181a416710060b1400416c41848f08410010071a2000416c10191a0b09002000200110191a0b0a0020002001ad1087010b3801017f230041106b220224002002420037030820022001200241086a10b601200020022802002002280204105310191a200241106a24000b870301027f20002001108c0141016a220410890121000240024002400240024002400240024002400240024020022f010041016b0e09010203040506070809000b200042001087010c090b105222034101102f200320022802041030200020031085010c080b105222034102102f200320022802041030200020031085010c070b105222034103102f200320022802041030200020031085010c060b105222034104102f20022802042003102e200020031085010c050b105222034105102f200241086a20031031200020031085010c040b105222034106102f200241086a2003108a01200020031085010c030b105222034107102f200241086a20031031200020031085010c020b105222034108102f200228020420031038200320022802081030200241026a2003108b012002410c6a20031037200020031085010c010b105222034109102f2003200228020410302002280208200310382003200228020c1030200241026a2003108b01200241106a20031037200020031085010b20012004ad10870120040b19002000102d220041c881084105100d1a20012000102e20000b9f0101027f230041306b22022400200120002802101030200028021410322001102e200220002802141006360214200241003602102002200041146a36020c0340200241186a2002410c6a1033200229031850450440200228022c2002280228200110362002290320200110b201200110380c010b0b2000290300200041086a290300200110352000280218200110362000411c6a20011037200241306a24000b3401017f230041106b22022400200220002f010022004108742000410876723b010e20012002410e6a41021051200241106a24000b2501017e2000200010ad0122014280808080105a04402000418d8008410e107e000b2001a70b0d0020002001108901108301450b9c06020a7f017e230041d0006b22042400024002402003450d002002108c012003490d000240200120031089012203108301450d002003108201220110062102200441003a002c2004200236022820042001360224200420023602202004410036021c024002400240024002400240024002400240024002402004411c6a2003108f0141ff01710e0a0a010203040506070809000b200341808008410d107e000b410121062004411c6a2003103d21080c080b410221062004411c6a2003103d21080c070b410321062004411c6a2003103d21080c060b410421062004411c6a2003107a21080c050b200441306a2004411c6a2003103c200428024c210920042802482102200428024421012004280240210b200428023c210c20042802382107200428023421052004280230210a410521060c040b2004411c6a22012003103d210b20012003107a2102104921010340200204402004411c6a220620031040210520062003109001210e200420062003103e36023c200420053602382004200e3703302001200441306a1066200241016b21020c010b0b200441086a2004411c6a22092003103f2004290310220e422088a7210c200ea7210741002105410621062004280208210a200920031040210220092003104121090c030b200441306a2004411c6a2003103c200428024c210920042802482102200428024421012004280240210b200428023c210c20042802382107200428023421052004280230210a410721060c020b410821062004411c6a22052003103e210820052003103d210a20052003104f210d20052003104121050c010b410921062004411c6a220522072003103d210820072003103e210a20052003103d210520072003104f210d20072003104121070b2004280220200428021c470d0220042d002c450d00419cde08410036020041a0de0841003a00000b20002009360224200020023602202000200136021c2000200b3602182000200c360214200020073602102000200536020c2000200a360208200020083602042000200d3b0102200020063b0100200441d0006a24000f0b41a88f0841121002000b2003418d8008410e107e000b2d01017f230041106b22022400200241003a000f20002002410f6a41012001105020022d000f200241106a24000b840102017e017f230041106b22032400200342003703082000200341086a41082001105020032903082102200341106a2400200242388620024280fe0383422886842002428080fc0783421886200242808080f80f834208868484200242088842808080f80f832002421888428080fc07838420024228884280fe038320024238888484840b0f00200020011092012002ad1087010b19002000102d220041cd8108410e100d1a20002001103020000b0d0020001094012001ad1087010b13002000102d220041db81084106100d1a20000b0e002000200110960120021085010b19002000102d220041e18108410e100d1a20012000102e20000b0c0020002001109201108c010b0a002000109401108c010b3101017f024020001083014504400c010b20002000109a01220141ff01714103490d00200041808008410d107e000b20010b2301017e2000200110ad01220242ff015804402002a70f0b2001418d8008410e107e000b3601017f02402000108301450d000240024020002000109a0141ff01710e020201000b200041808008410d107e000b410121010b20010b0c0020002001109d011084010b19002000102d220041ef81084106100d1a20012000102e20000ba90101067f0240200028020822052001109f01220304400240200320002802042204108c0122024d044020022003460d012004108c012002490d03200028020022072002104c21062004108c012003490d03200720031089012006ad1087010c010b0c020b2004108c012002490d01200028020020021089011084012004200241016b1086012002200347044020052006200310a0010b20052001109c010b0f0b41a88f0841121002000b0c0020002001109d01108c010b0f0020002001109d012002ad1087010b4801037f20002802082203200110a20145044020002802042202108c0121042000280200200441016a22001089012001ad10870120022000108601200320012002108c0110a0010b0b0c0020002001109f014100470b08002000108c01450b0d0010491a20002001102d104a0b1401017f104922022001ad10a60120002002104a0b3601017f230041106b220224002002420037030820022001200241086a10b60120002002280200200228020410071a200241106a24000b1801017f104922022001ad42ff018310a60120002002104a0b0d0010491a200020011057104a0b120020011049102d2201103920002001104a0b1301017f10492202200110a60120002002104a0b5101017f230041206b2202240020022001280200100636021c20024100360218200220013602140340200241086a200241146a103b200228020804402000200228020c10a4010c010b0b200241206a24000b1201017f10492202200020011053104a20020ba40102017e027f230041106b2203240020034200370308200010820122041006220041094f04402001418d8008410e107e000b20044100200320006b41106a200010771a20032903082102200341106a2400200242388620024280fe0383422886842002428080fc0783421886200242808080f80f834208868484200242088842808080f80f832002421888428080fc07838420024228884280fe038320024238888484840b2001017f20001082012201100641204704402000419482084110107e000b20010b5401047f230041106b22012400200010b0012102200141086a2000280208200028020022032002107d2001280208410147044041b98108410f10b101000b200128020c2000200220036a360200200141106a24000b7101017f230041106b220124002001410036020c200041086a20002802002001410c6a4104108101044041b98108410f10b101000b2000200028020041046a360200200128020c2100200141106a2400200041187420004180fe03714108747220004108764180fe0371200041187672720b1a01017f419b800841191053220220002001100d1a2002100e000b7701017f230041106b220224002002200042388620004280fe0383422886842000428080fc0783421886200042808080f80f834208868484200042088842808080f80f832000421888428080fc07838420004228884280fe038320004238888484843703082001200241086a41081051200241106a24000b7d01037f230041106b22012400200028020821032001410036020c200028020020034102742001410c6a41041077450440200128020c21022000200341016a360208200241187420024180fe03714108747220024108764180fe037120024118767272102d200141106a24000f0b41a48208410841f380084111105c000bde0102017e027f230041106b220324000240200128020820012802044f047f410005200110b30121012003420037030820011006220441094f0d0120014100200320046b41106a200410771a2003290308220242388620024280fe0383422886842002428080fc0783421886200242808080f80f834208868484200242088842808080f80f832002421888428080fc07838420024228884280fe0383200242388884848422024280808080105a0d012002a7210441010b21012000200436020420002001360200200341106a24000f0b41a482084108418d8008410e105c000b2e01027f2001102d21022001102d2203419082084104100d1a2000200336020420002001360200200020023602080be90102027f027e2002200142388620014280fe0383422886842001428080fc0783421886200142808080f80f834208868484200142088842808080f80f832001421888428080fc07838420014238882205200142288822064280fe038384848437000020004108410020055022032001423088a741ff01711b220420036a410020042006a741ff01711b22036a410020032001422088a741ff01711b22036a410020032001a722034118761b22046a41002004200341107641ff01711b22046a41002004200341087641ff01711b22036a200341002001501b6a22036b3602042000200220036a3602000b09002000101a41004a0b5001037f024020012d00080d0020012802002203200128020422044b0d00200320044f044041012102200141013a00080c010b410121022001200341016a3602000b20002003360204200020023602000b2001017e101d220042e0a71258044041828a0841191058000b200042e0a7127d0b0a0041c98208410810530b1700200141d18208410d10532201102e2000200110b5010b2901027f41de8208410b10532201102d2202419082084104100d1a20002002360204200020013602000b0a0041e98208410d10530b1200200041f68208410910532200102e20000b1200200041ff8208411010532200102e20000b17002001418f8308411110532201102e2000200110b5010b0a0041a08308411110530b1200200041b18308411110532200102e20000b1200200041c28308411310532200102e20000b0a0041d58308411410530b0a0041e98308410a10530b6202037f027e2001280210102d210220012802141028210320012903002105200129030821062001280218102d21042001411c6a1048210120002003360214200020023602102000200136021c2000200436021820002006370308200020053703000bdc0101037f230041406a22012400200141106a10c80102400240024020012d0014410246044020012802102102200010c301109b010d012001411c6a200010bb012001280220220010a3010d0220012000108c013602302001410136022c20012001411c6a3602280340200141086a200141286a104b2001280208450d04200128020c2100200110bc0120012802002000108d01450440200141346a2203200010c0012003200210a1010c010b0b41a7860841151058000b41e58508411b1058000b4180860841271058000b41bc860841101058000b200141406b24000b2401017f105a2101200010ba012001109701220110be011099013a0004200020013602000b4701027f230041206b22022400200241086a10bc0120022802082000108d01450440200241146a2203200010c00120032001109e01200241206a24000f0b41a7860841151058000b8a0101037f230041206b22012400200141086a10bc01024020012802082000108d01450440200010bf01108c012202450d01200210c301109b01450d014180860841271058000b41a7860841151058000b200110c80120012d0004410247044041e58508411b1058000b20012802002102200141146a2203200010c0012003200210a101200141206a24000b6e01027f230041206b22012400200141086a2202200010c001104921002001200128020c108c0136021c2001410136021820012002360214037f2001200141146a104b2001280200047f20012802042102200010ba01200210960110ae01104a0c0105200141206a240020000b0b0b2401027f230041106b22002400200041086a10bc01200028020c108c01200041106a24000b19002002450440200041013a00000b200110be0142021087010b7501027f230041306b22012400200141146a2202200010c00120012001280218108c013602282001410136022420012002360220410021000340200141086a200141206a104b20012802084101474504402000200128020c10be0110990141ff01714102466a21000c010b0b200141306a240020000bbe0402077f017e230041406a220324002003410c6a200110760240200328022c2205044002402005411b470d002003410c6a2105411b210741a6880821040240034020052d0000220820042d00002209460440200541016a2105200441016a2104200741016b22070d010c020b0b200820096b21060b20060d0010704100106f20034100360230200341346a2105230041106b220124000240200341306a220441c18808410b105f100f220a428080808010540440027f200aa7220641ebde0147410020061b450440200441c18808410b106221042001410036020441040c010b027f200428020041a4de082802004e044010490c010b200441c18808410b105e0b2104200120063602082001410136020441080b200141046a6a200436020020052001290204370200200541086a2001410c6a280200360200200141106a24000c010b41c18808410b418d8008410e105c000b2003280230106d200328023c2104200328023821012003280234210620052002107110702003280238200328023c4b04404184810841121002000b0240200645044041aa8508411010ac0121022003200136023020032001100636023c200341003602382003200341306a36023403402003200341346a103b200328020004402002200328020410a4010c010b0b0c010b419c8508410e10ac012102104922052001ad10a60120022005104a2002200410a4010b20021049101b200041003602000c020b2000200236020820002001360204200041013602000c010b200041003602000b200341406b24000bf50101037f230041306b22012400200141106a10bc0120012802102000108901108401200141186a2202200010c0012001200128021c108c0136022c200141013602282001200236022403400240200141086a200141246a104b200128020804402001280220200128020c109c010c0205200128021c108c012102200141003a002c200120023602282001410136022403402001200141246a10b8012001280200450d02200128021820012802041089011084010c000b000b000b0b200128021c4200108701200010bf012203108c012102200310840120020440200141246a2203200210bb0120032000109e010b200141306a24000bc310020d7f037e23004190016b22022400200210bc01200241086a200228020020022802042001108e010240200110bf01108c01220b450d00200b10c301109b01450d0041cc8808412a1058000b024002400240024002400240024002400240024020022f0108220d41016b0e09000102030405060708090b200228020c102d21040c080b200228020c102d21040c070b200228020c102d21040c060b200228020c21040c050b200241306a200241106a10c6012002290338221042808080807083210f20022903302211422088a72103200228024c210820022802482109200228024421062002280240210a2010a721072011a721050c040b2002280220102d210a1049210620022002280224100636028c0120024100360288012002200241246a360284010340200241306a20024184016a10332002290330504504402002290338210f200228024421032002280240102d21052002200310283602742002200f370368200220053602702006200241e8006a10660c010b0b2002290318221042808080807083210f2010a7210741002103200228021021052002280228102d21092002412c6a104821080c030b200241306a200241106a10c6012002290338221042808080807083210f20022903302211422088a72103200228024c210820022802482109200228024421062002280240210a2010a721072011a721050c020b200228020c102821042002280210102d210520022f010a210c200241146a104821030c010b200228020c102d21042002280210102821052002280214102d210320022f010a210c200241186a104821070b200110cb01210e2002200b36025c200220013602582002200e36026020022008360254200220093602502002200636024c2002200a360248200220043602342002200c3b01322002200d3b01302002200f2007ad8437034020022005ad2003ad4220868437033841948408411210ac01210320021049360268200241306a200241e8006a102c20032002280268101b200110d001410121050240024002400240024002400240024002400240024002400240024020022f010841016b0e090506070800010203040c0b200241c8006a200241286a290300370300200241406b200241206a290300370300200241386a200241186a290300220f370300200220022903102210370330201050044010b901210f0b41e88408411a10ac012203200110a5012003200228024010a4012003200228024410a8012003200f10aa012003200228024810a4012003200241cc006a10ab0120031049101b20022802402002280244200f2002280248200228024c101c450d0b41ba8f08411b1058000b200241c8006a200241286a290300370300200241406b200241206a290300370300200241386a200241186a290300220f370300200220022903102210370330201050044010b901210f0b41828508411a10ac012204200110a5012004200228024010a4011049102d210120022002280244100636028c0120024100360288012002200241c4006a36028401200241f0006a21030340200241e8006a20024184016a10332002290368500d082003200110340c000b000b200241c8006a2200200241286a290300370300200241406b2203200241206a290300370300200241386a200241186a290300220f3703002002200229031022103703302010a745044010b901210f0b20032802002103200228024421042000280200210541f38308411010ac012200200110a5012000200310a4012000200410a8012000200f10aa012000200510a4012000200241cc006a10ab0120001049101b10491a200228024c21002002280244210110492104200241a6880836027820022001360274200220033602702002200036026c2002200536026820022004ad422086421b8437027c200241e8006a220141106a220228020022030440107510522100200228020422042000102e200020032004100d1a200241086a2000103720001085010b200128020c2102200128020821032001280200210520012802042104230041206b220024002000200336020c200020023602082000200436021c2000200536021820002001411c6a3602142000200041086a360210200041106a2000410c6a1078000b20022f010a210520022802102104200228020c210620022002280214360230101d210f41b98408411710ac012203200110a5012003200610a8012003200410a4012003200510a9012003200f10aa012003200241306a10ab0120031049101b2002280230210120051059200f2006200441672001102922031029101e1a410021050c080b20022f010a21042002280214210620022802102107200228020c210820022002280218360230101d210f41d08408411810ac012203200110a5012003200810a4012003200710a8012003200610a4012003200410a9012003200f10aa012003200241306a10ab0120031049101b20022802302101200410592008200f20072006416720014167101f0c070b200228020c210310c101108c01411e4f0d0420012003410210d2010c060b2001200228020c410110d20110c501108c0110c101108c014d0d050c060b2001200228020c410010d20110c101108c012201410010bd01108c016b460d0310c501108c0120014d0d040c050b200228020c220310c101108c014b0d0410c501200310860141a68408411310ac012204200110a5012004200310a50120041049101b0c030b20042001104a2004200f10aa012004200228024810a4012004200241cc006a10ab0120041049101b20022802402002280244200f2002280248200228024c1020450d0241d58f0841221058000b419e8708411e1058000b41b08908412d1058000b200020033602042000200536020020024190016a24000f0b41918908411f1058000bee0101027f10ba0122042001109701210302400240200241ff0171044020030d012004200410980141016a22031093012004200120031091012004200320011095010c010b2003450d010b200310be012203109901210420032002ad42ff018310870141838408411110ac012203200010a5012003200110a4012003200410a7012003200210a70120031049101b200441ff01712200410247417f410020004102461b200241ff017122014102461b2202044010c10122032003108c0120026a1086010b2000410147417f410020004101461b20014101461b2200450d0010bd0122012001108c0120006a1086010b0b1601017f200010c201108c012101200010ce0120014f0b3d01017f230041306b220324002003410c6a200110762000200328022c047f200020023602082000200136020441010541000b360200200341306a24000b800101037f230041206b22012400200141086a10c80120012d000c220241016b41ff0171410249044020012802082103200110bc01200128020020012802042000108801220010c20110c501108c0110860120024102460440200141146a2202200010c0012002200310a1010b200141206a240020000f0b41a48b08412c1058000b3301017f200010ce01450440200010bf01108c0122010440200110c30142011087010b200010d0010f0b41a88d08412b1058000b940101037f230041206b220124001049210310ba011098012102200141003a001c2001200236021820014101360214200041ff0171210003400240200141086a200141146a10b8012001280208450d00200128020c220210be0110990141ff01712000470d0110ba0120021096012202108301450d01200210ae01210210491a20032002102d104a0c010b0b200141206a240020030bc60301067f230041306b22002400102110704101106f410041a088084106106c210420004101360224200041246a419b88084105105d21012000280224106d200020013602181049210220002001100636022c200041003602282000200041186a3602240240024002400240024003400240200041106a200041246a103b2000280210450d002000280214102d102d220110064120470d0220022001104a0c010b0b2000200236021c200041003a002310c101108c012002103a6a411f4f0d0110ba012101200210062103200110980121022000200336022c2000410036022820002000411c6a36022403400240200041086a200041246a103b2000280208450d002001200028020c220310970122050440200041236a2005410010cd010c020520012003200241016a2202109101200120022003109501200041236a2002410110cd010c020b000b0b2001200210930120002d00230d0210c10122012001108c01200028021c103a6a22011086012001410010bd01108c016b460d0320012004490d0410c5012004108601200041306a24000f0b41948208411010b101000b419e8708411e1058000b41bc870841161058000b41c48e08413e1058000b41918908411f1058000b080010214100106e0b06004100106e0b4a01027f230041106b2200240010214101106e410041ba85084109106c200041086a10c80120002d000c41016b41ff017141024f044041f48c0841341058000b10d601200041106a24000b850101027f230041206b22002400102110704100106f20004100360214200041146a41d28708410a105d21012000280214106d200041086a10c80120002d000c41016b41ff01714102490440200041146a2001107f03402000200041146a10b40120002802000440200028020410d6010c010b0b200041206a24000f0b41f48c0841341058000b0d0010214100106e10c50110730b0d0010214100106e10c10110730b120010214100106e41bf8208410a105310730b0d0010214100106e10bd0110730b6601027f230041206b2200240010214101106e200041086a2201410041c785084108106c10bb012000200028020c108c0136021c200041013602182000200136021403402000200041146a104b20002802000440200035020410120c010b0b200041206a24000b0d0010214100106e10c40110730b0e0010214100106e10cc01ad10120b0d004101411441e48a081084020b0d004102411041ca8a081084020b0d004103410c41be8a081084020b3f01027f230041306b2200240010214101106e410041da8a08410a106c2101200041043b01082000200136020c200041086a10d501ad1012200041306a24000b070041051085020bc80202077f027e230041406a22002400102110704103106f410041bc8a084102106a2106230041306b2201240041011056210410492105200410062102200141003a001c2001200236021820012004360214200120023602102001410036020c037f2002200346047f20012d001c0440419cde08410036020041a0de0841003a00000b200141306a2400200505200141206a22022001410c6a41948b0841061065200520021066200128020c2103200128021021020c010b0b2101200041086a10672000290310210720002903082108200041033602182000200041186a106320002802042102200028020021032000280218106d2001108001044041df8c0841151058000b20002003360238200020013602342000200636023020002008370320200041063b01182000200236023c20002007370328200041186a10d501ad1012200041406b24000b070041071085020b7801067f230041306b22002400102110704103106f4100106421014101418e8b084106106a21024102106b210320004103360208200041086a2204106121052000280208106d200020023602102000200136020c20002005360214200020033b010a200041083b0108200410d501ad1012200041306a24000b8b0101077f230041306b22002400102110704104106f4100419a8b08410a106a21014101106421024102418e8b084106106a21034103106b210420004104360208200041086a2205106121062000280208106d20002003360214200020023602102000200136020c20002006360218200020043b010a200041093b0108200510d501ad1012200041306a24000bca0902117f017e23004180016b22002400102110704100106f20004100360240200041406b419b8a084107105d21012000280240106d10c401108c01210202400240024002400240024002402001108001450440200041186a10c80120002d001c220341016b41ff017141024f0d012000280218210d200041106a10bc012000280214210e2000280210210f200041246a200241016a220810bb01200810c3014200108701200028022810a301450d02200041306a20011071200341ff017141024721100340200028023820002802344904400240200041306a10b30122021006450440410021010c010b41002101200210062103200041003a007c2000200336027820002002360274200020033602702000410036026c02400240024002400240024002400240024002400240200041ec006a41a482084108106841ff01710e0a0a010203040506070809000b41a48208410841808008410d105c000b41012101200041ec006a104321050c080b41022101200041ec006a104321050c070b41032101200041ec006a104321050c060b41042101200041ec006a41a482084108106021050c050b200041406b200041ec006a1042200028025c210620002802582109200028025421022000280250210a200028024c210b200028024821042000280244210320002802402107410521010c040b200041ec006a22011043210a200141a4820841081060210110492102034020010440200041406b2203200041ec006a41a4820841081065200220031066200141016b21010c010b0b2000200041ec006a2206104520002903082211422088a7210b2011a72104410021034106210120002802002107200641a482084108104621092006104721060c030b200041406b200041ec006a1042200028025c210620002802582109200028025421022000280250210a200028024c210b200028024821042000280244210320002802402107410721010c020b41082101200041ec006a220341a48208410810442105200310432107200341a482084108104d210c2003104721030c010b41092101200041ec006a220410432105200441a48208410810442107200041ec006a10432103200441a482084108104d210c2004104721040b2000280270200028026c470d0620002d007c450d00419cde08410036020041a0de0841003a00000b20002006360264200020093602602000200236025c2000200a3602582000200b360254200020043602502000200336024c20002007360248200020053602442000200c3b0142200020013b014002400240200141076b0e03080108000b2001450d070b1029220210222002105b2102024002400240200141056b0e020001020b2000280258105b200028025c10b70145044020002802601080010d0a0b2002460d0141b48c08412b1058000b200028025c1080010d092000280258105b2002470d0a0b200f200e200041406b10880121012010450440200041ec006a2202200110c0012002200d10a1010b200041246a200110a101200110bf0120081086010c010b0b10c40120081086012008ad101220004180016a24000f0b41ff8b08410a1058000b41a48b08412c1058000b41d08b08412f1058000b41a482084108418d8008410e105c000b41a68c08410e1058000b41898c08411d1058000b41df8c0841151058000b41b48c08412b1058000b150010214101106e410041ba85084109106c10ca010b150010214101106e410041c785084108106c10c7010b890101047f230041106b220024001021410121024101106e410041ba85084109106c220110ca01200041086a10c801024020002d000c41016b41ff01714102490440200110d301047f200110bf01108c010d022000200110d1012000280204210320002802000541010b20031074200041106a24000f0b41ea860841341058000b41dd890841251058000bc60201047f230041d0006b220024001021410121014101106e410041c785084108106c220310c701200041286a10c801024020002d002c41016b41ff01714102490440200041386a2202200310bb012000200028023c108c0136024c20004101360248200020023602440340200041206a200041c4006a104b20002802200440200028022410d30120017121010c01052001410171450d03200010492201360234200041386a2202200310bb012000200028023c108c0136024c20004101360248200020023602440340200041186a200041c4006a104b200028021804402001200028021c104a0c010520002001100636024c200041003602482000200041346a3602440340200041106a200041c4006a103b2000280210450d06200041086a200028021410d1010c000b000b000b000b000b000b41ea860841341058000b200041d0006a24000b4801027f230041106b2200240010214101106e410041ba85084109106c200041086a10c80120002d000c410247044041cc8608411e1058000b200028020810c901200041106a24000baa0101037f230041306b2200240010214101106e410041c785084108106c2101200041106a10c801024020002d0014410246044020002802102102200041186a200110bb01200028021c220110a3010d0120002001108c0136022c200041013602282000200041186a3602240340200041086a200041246a104b20002802080440200028020c200210c9010c010b0b200041306a24000f0b41cc8608411e1058000b41bc860841101058000b5901037f230041106b2200240010214102106e410041c385084104106a2101410141ba85084109106c210210ba0120011097012201047e200041046a200210c001200028020c200110a201ad0542000b1023200041106a24000bdb0201077f230041306b22002400102110704101106f410041ba85084109106c210320004101360220200041206a41cf85084116105d21012000280220106d1049210202402001108001450440200041206a2001107f0340200041086a200041206a10b4012000280208450d02200028020c220110be0110990141ff01714102460d0020022001104a0c000b000b200041146a2201200310c00120002000280218108c01360228200041013602242000200136022003402000200041206a104b2000280200450d012000280204220110be0110990141ff01714102460d0020022001104a0c000b000b200210062105410021010340200141046a220620054b4504402000410036022020022001200041206a2204410410771a200028022021012004200310c0012004200141187420014180fe03714108747220014108764180fe037120014118767272109e01200621010c010b0b200041306a24000b180010214101106e410041ba85084109106c10d301ad10230b870101027f230041106b2200240010214101106e410041ba85084109106c2101200041086a10c8010240024020002d000c41016b41ff01714102490440200110d301450d01200110bf01108c010d022000200110d101200028020020002802041074200041106a24000f0b41ea860841341058000b41f68808411b1058000b41dd890841251058000b9e0201037f230041406a2200240010214101106e410041c785084108106c2101200041186a10c80120002d001c41016b41ff01714102490440200110c301109b01450440200041246a200110bb012000280228220210a30145044020001049220136023020002002108c0136023c200041013602382000200041246a36023403400240200041106a200041346a104b2000280210044020012000280214104a0c020520002001100636023c200041003602382000200041306a36023403400240200041086a200041346a103b2000280208450d00200028020c220110d301450d032000200110d1010c010b0b200041406b24000f0b000b0b41f68808411b1058000b41bc860841101058000b41cc8808412a1058000b41ea860841341058000baa0201067f230041206b22002400024010244504401029220110252001105a102641004c0d014102106e410041ac8208410b106a210141011056210220002001360200027f41a8de082d000022010440417541ffffffff0720011b0c010b41a8de0841013a00004175100b41750b1028210341b7820841081053210410492205200210a401200041146a220120053602082001200436020420012000360200200020033602082000200029021837020c20002000280214360204200041046a220128020421022001280200210320012802082104200128020c2105230041206b220024002000200236020c2000200536021c200020043602182000200141106a36021420002000410c6a360210200041106a20031078000b41ce800841251002000b41848f0841241002000ba90401087f23004190016b22002400102110704100106f20004100360228200041d0006a2102230041206b2201240002400240200041286a220328020041a4de082802004e047f4101052001410c6a22052204200341dc87084109105f1055200441dc8708410910602104200541dc87084109106021032001280210200128020c470d0120012d001c0440419cde08410036020041a0de0841003a00000b41000b2105200220033602082002200436020420022005360200200141206a24000c010b41dc87084109418d8008410e105c000b2000280228106d2000280258210120002802542104200028025021051049210310cc012102200041106a10bc012000280214210620002802102107024020050440410121010c010b200120024d04402002200120046a22024f0d01419b8e0841291058000b41d38d0841c8001058000b200041003a0024200020023602202000200136021c03400240200041086a2000411c6a10b8012000280208450d00200041286a20072006200028020c2201108e0120002f0128450d01200110cb0121022000200110bf01108c0136027c20002001360278200041d0006a2201200041286a412810830220002002360280012000104936028c0120012000418c016a102c2003200028028c01104a0c010b0b2000200336028c012000200310063602582000410036025420002000418c016a36025003402000200041d0006a103b20002802000440200028020410051a0c010b0b20004190016a24000b3501017f10214101106e410041c385084104106a210010ba0120001097012200047e200010be01109901ad42ff01830542000b10120b070041021086020b070041011086020b950301027f230041306b2201240010214101106e410041ba85084109106c2100200110bc01200141086a200128020020012802042000108e010240024002400240024002400240024002400240024020012f010841016b0e09010203040506070809000b420010120c090b105222004101102f2000200128020c10031a200010540c080b105222004102102f2000200128020c10031a200010540c070b105222004103102f2000200128020c10031a200010540c060b105222004104102f200128020c2000102e200010540c050b105222004105102f200141106a20001031200010540c040b105222004106102f200141106a2000108a01200010540c030b105222004107102f200141106a20001031200010540c020b105222004108102f200128020c200010382000200128021010031a200141086a4102722000108b01200141146a20001037200010540c010b105222004109102f2000200128020c10031a2001280210200010382000200128021410031a200141086a4102722000108b01200141186a20001037200010540b200141306a24000b7301037f230041206b2200240010214101106e2000410041ba85084109106c10cb0122023602101052210120002002100636021c200041003602182000200041106a3602140340200041086a200041146a103b200028020804402001200028020c10031a0c010b0b20011054200041206a24000b3701017f230041106b2200240010214101106e200041046a410041ba85084109106c10c0012000280208108c01ad1012200041106a24000b180010214101106e410041ba85084109106c10ce01ad10120bd90201057f230041e0006b220024000240024002401075220410820122011080010d002001102d220210062101200041003a00402000200136023c200020023602382000200136023420004100360230200041306a220110af012102200110b0012101104921030340200104402003200041306a10af01104a200141016b21010c010b0b20002802342000280230470d0120002d00400440419cde08410036020041a0de0841003a00000b20041084012000410c6a20021076200028022c450d00200041306a2002200310d4012000280230450d0020002802382101200041306a2000280234220210762000280250450d00200041d4006a2002200110d4012000280254450d00200041d4006a2000280258200028025c10cf012000280254450d00200041306a2000280258200028025c10cf0120002802300d020b200041e0006a24000f0b418d8008410e10b101000b41e5870841361002000bab0201067f20002103200241104f04402003410020036b41037122006a210420000440200121050340200320052d00003a0000200541016a2105200341016a22032004490d000b0b2004200220006b2207417c7122066a21030240200020016a22004103710440200641004c0d012000410374220241187121082000417c71220541046a2101410020026b4118712102200528020021050340200420052008762001280200220520027472360200200141046a2101200441046a22042003490d000b0c010b200641004c0d0020002101034020042001280200360200200141046a2101200441046a22042003490d000b0b20074103712102200020066a21010b20020440200220036a21000340200320012d00003a0000200141016a2101200341016a22032000490d000b0b0b3d01027f230041306b2203240010214101106e410020022001106a2104200320003b01082003200436020c200341086a10d501ad1012200341306a24000bc10102057f027e230041406a22012400102110704103106f410041bc8a084102106a2104410110642102200141086a10672001290310210620012903082107200141033602182001200141186a106320012802042105200128020021032001280218106d0240200210b7010d002003108001450d0041898c08411d1058000b20012003360238200120023602342001200436023020012007370320200120003b01182001200536023c20012006370328200141186a10d501ad1012200141406b24000b2b01017f230041106b2201240010214100106e2001200010d70136020c2001410c6a1072200141106a24000b0b99100200418080080b8510696e76616c69642076616c7565696e70757420746f6f206c6f6e6773657269616c697a6572206465636f6465206572726f723a20617267756d656e74206465636f6465206572726f722028293a2066756e6374696f6e20646f6573206e6f74206163636570742045534454207061796d656e74746f6f2066657720617267756d656e7473746f6f206d616e7920617267756d656e747377726f6e67206e756d626572206f6620617267756d656e747343425f434c4f53555245696e70757420746f6f2073686f72742e6974656d5f616464726573735f746f5f69645f636f756e745f69645f746f5f616464726573732e696e64657873746f72616765206465636f6465206572726f7220286b65793a202e6c656e626164206172726179206c656e6774687661722061726773646e735f6164647265737372656769737465726e756d5f67726f757073757365725f696473616374696f6e5f67726f757073616374696f6e5f646174616e756d5f70726f706f73657273757365725f726f6c6567726f75705f666f725f616374696f6e616374696f6e5f7369676e65725f6964736e756d5f626f6172645f6d656d6265727371756f72756d5f666f725f616374696f6e616374696f6e5f67726f75705f7374617475736c6173745f616374696f6e5f67726f75705f696471756f72756d5f696473706572666f726d4173796e6343616c6c706572666f726d4368616e6765557365727374617274506572666f726d416374696f6e706572666f726d4368616e676551756f72756d706572666f726d4465706c6f7946726f6d536f75726365706572666f726d5570677261646546726f6d536f75726365706572666f726d5472616e736665724578656375746545676c64706572666f726d5472616e7366657245786563757465457364746173796e6343616c6c4572726f726173796e6343616c6c53756363657373616374696f6e5f69647573657267726f75705f69646f757464617465645f626f6172645f6d656d626572736f6e6c7920626f617264206d656d626572732063616e207369676e63616e6e6f74207369676e20616374696f6e73206f6620616e2061626f72746564206261746368616374696f6e20646f6573206e6f74206578697374496e76616c69642067726f75702049446f6e6c7920626f617264206d656d626572732063616e20756e2d7369676e6f6e6c7920626f617264206d656d6265727320616e642070726f706f736572732063616e20706572666f726d20616374696f6e73626f6172642073697a652063616e6e6f7420657863656564206c696d69746475706c696361746520626f617264206d656d626572616374696f6e5f6964736f70745f72616e67656e6f2063616c6c6261636b2066756e6374696f6e20776974682074686174206e616d652065786973747320696e20636f6e7472616374626f61726471756f72756d706572666f726d5f6173796e635f63616c6c5f63616c6c6261636b63616c6c5f726573756c7463616e6e6f7420706572666f726d20616374696f6e73206f6620616e2061626f7274656420626174636871756f72756d20686173206e6f74206265656e207265616368656471756f72756d2063616e6e6f742065786365656420626f6172642073697a6563616e6e6f742072656d6f766520616c6c20626f617264206d656d6265727320616e642070726f706f736572734d6179206e6f742065786563757465207468697320616374696f6e20627920697473656c66696e73756666696369656e742067617320666f722063616c6c616374696f6e7366756e6374696f6e5f63616c6c6f70745f6761735f6c696d6974746f757365725f6164647265737370726f706f7365725f616464726573736e65775f71756f72756d626f6172645f6d656d6265725f61646472657373617267756d656e7473636f64655f6d65746164617461736f75726365746f6b656e7373635f616464726573736f6e6c7920626f617264206d656d6265727320616e642070726f706f736572732063616e2070726f706f736563616e6e6f742061646420616374696f6e7320746f20616e20616c7265616479206578697374696e672062617463684e6f20616374696f6e7370726f706f73656420616374696f6e20686173206e6f20656666656374496e76616c696420616374696f6e416c6c207472616e736665722065786563206d75737420626520746f207468652073616d652073686172644e6f20746f6b656e7320746f207472616e736665726f6e6c7920626f617264206d656d6265727320616e642070726f706f736572732063616e206469736361726420616374696f6e7363616e6e6f74206469736361726420616374696f6e20776974682076616c6964207369676e61747572657366697273745f616374696f6e5f6964206e6565647320746f2062652077697468696e207468652072616e6765206f662074686520617661696c61626c6520616374696f6e2069647363616e6e6f74206578636565642074686520746f74616c206e756d626572206f6620616374696f6e73626f6172642063616e6e6f7420626520656d707479206f6e20696e69742c206e6f2d6f6e6520776f756c642062652061626c6520746f2070726f706f73650000456e64706f696e742063616e206f6e6c792062652063616c6c6564206279206f776e6572696e646578206f7574206f662072616e67657472616e7366657256616c756545786563757465206661696c65646d756c74695472616e73666572455344544e465445786563757465206661696c656470616e6963206f6363757272656400418890080b0438ffffff@0500@0504@02@0139472eff6886771a982f3083da5d421f24c29181e63888228dc81ca60d69e1@3fb81f4303be6f7377350b8a595f94b13fd6cbce4c4c7d2c63e9e1f8f0d42cf1"
	tx := generateTransaction(sender.Bytes, 0, receiverBytes, big.NewInt(0), dataField, 0)

	cost, err := cs.GetNodeHandler(0).GetFacadeHandler().ComputeTransactionGasLimit(tx)
	require.NoError(t, err)
	require.Equal(t, uint64(84998085), cost.GasUnits)
	require.Equal(t, "", cost.ReturnMessage)
}

func TestSimulateIntraShardTxWithGuardian(t *testing.T) {
	if testing.Short() {
		t.Skip("this is not a short test")
	}

	roundDurationInMillis := uint64(6000)
	roundsPerEpochOpt := core.OptionalUint64{
		HasValue: true,
		Value:    20,
	}

	cs, err := chainSimulator.NewChainSimulator(chainSimulator.ArgsChainSimulator{
		BypassTxSignatureCheck:   true,
		TempDir:                  t.TempDir(),
		PathToInitialConfig:      defaultPathToInitialConfig,
		NumOfShards:              3,
		GenesisTimestamp:         time.Now().Unix(),
		RoundDurationInMillis:    roundDurationInMillis,
		RoundsPerEpoch:           roundsPerEpochOpt,
		ApiInterface:             api.NewNoApiInterface(),
		MinNodesPerShard:         3,
		MetaChainMinNodes:        3,
		NumNodesWaitingListMeta:  3,
		NumNodesWaitingListShard: 3,
		AlterConfigsFunction: func(cfg *config.Configs) {

		},
	})
	require.NoError(t, err)
	require.NotNil(t, cs)

	err = cs.GenerateBlocksUntilEpochIsReached(1)
	require.NoError(t, err)

	initialBalance := big.NewInt(0).Mul(oneEGLD, big.NewInt(10))

	sender, err := cs.GenerateAndMintWalletAddress(0, initialBalance)
	require.NoError(t, err)

	receiver, err := cs.GenerateAndMintWalletAddress(0, big.NewInt(0))
	require.NoError(t, err)

	guardian, err := cs.GenerateAndMintWalletAddress(0, initialBalance)
	require.NoError(t, err)

	err = cs.GenerateBlocks(1)
	require.NoError(t, err)

	senderNonce := uint64(0)
	// Set guardian for sender
	setGuardianTxData := "SetGuardian@" + hex.EncodeToString(guardian.Bytes) + "@" + hex.EncodeToString([]byte("uuid"))
	setGuardianGasLimit := 10_000_000
	setGuardianTx := generateTransaction(sender.Bytes, senderNonce, sender.Bytes, big.NewInt(0), setGuardianTxData, uint64(setGuardianGasLimit))
	_, err = cs.SendTxAndGenerateBlockTilTxIsExecuted(setGuardianTx, 10)
	require.NoError(t, err)
	senderNonce++

	// fast-forward until the guardian becomes active
	for i := 0; i < 21; i++ {
		err = cs.ForceChangeOfEpoch()
		require.NoError(t, err)
	}

	// guard account
	guardAccountTxData := "GuardAccount"
	guardAccountGasLimit := 10_000_000
	guardAccountTx := generateTransaction(sender.Bytes, senderNonce, sender.Bytes, big.NewInt(0), guardAccountTxData, uint64(guardAccountGasLimit))
	_, err = cs.SendTxAndGenerateBlockTilTxIsExecuted(guardAccountTx, 10)
	require.NoError(t, err)
	senderNonce++

	esdtTransferTx := generateTransaction(sender.Bytes, senderNonce, receiver.Bytes, big.NewInt(0), "ESDTTransfer@010101@01@01", 500_000)
	cost, err := cs.GetNodeHandler(0).GetFacadeHandler().ComputeTransactionGasLimit(esdtTransferTx)
	require.NoError(t, err)
	require.Equal(t, "transaction is not executable and gas will not be consumed, not allowed to bypass guardian: ", cost.ReturnMessage)

	esdtTransferTx.GuardianAddr = guardian.Bytes
	esdtTransferTx.Options = 2
	esdtTransferTx.Version = 2
	esdtTransferTx.GuardianSignature = []byte("aaa")
	cost, err = cs.GetNodeHandler(0).GetFacadeHandler().ComputeTransactionGasLimit(esdtTransferTx)
	require.NoError(t, err)
	require.Equal(t, "failed transaction, gas consumed: insufficient funds", cost.ReturnMessage)
}

func generateTransaction(sender []byte, nonce uint64, receiver []byte, value *big.Int, data string, gasLimit uint64) *transaction.Transaction {
	return &transaction.Transaction{
		Nonce:     nonce,
		Value:     value,
		SndAddr:   sender,
		RcvAddr:   receiver,
		Data:      []byte(data),
		GasLimit:  gasLimit,
		GasPrice:  1_000_000_000,
		ChainID:   []byte(configs.ChainID),
		Version:   1,
		Signature: []byte("ssig"),
	}
}
